{"version":3,"sources":["../src/scheduledtasks.js"],"names":["refreshRunningTasksButton","buttonHandler","disabled","M","util","js_pending","showError","js_complete","Notification","alert","get_string","Ajax","call","methodname","args","done","data","Templates","render","then","result","document","querySelector","outerHTML","init","catch","fail","getElementById","addEventListener"],"mappings":"8LA0BA,OACA,OACA,O,mDAKA,GAAIA,CAAAA,CAAJ,CAKA,QAASC,CAAAA,CAAT,EAAyB,CACrBD,CAAyB,CAACE,QAA1B,IACAC,CAAC,CAACC,IAAF,CAAOC,UAAP,CAAkB,mBAAlB,EAEA,GAAMC,CAAAA,CAAS,CAAG,UAAM,CACpBN,CAAyB,CAACE,QAA1B,IACAC,CAAC,CAACC,IAAF,CAAOG,WAAP,CAAmB,mBAAnB,EACAC,UAAaC,KAAb,CAAmBN,CAAC,CAACC,IAAF,CAAOM,UAAP,CAAkB,OAAlB,CAA2B,QAA3B,CAAnB,CACIP,CAAC,CAACC,IAAF,CAAOM,UAAP,CAAkB,eAAlB,CAAmC,WAAnC,CADJ,CACqDP,CAAC,CAACC,IAAF,CAAOM,UAAP,CAAkB,IAAlB,CAAwB,QAAxB,CADrD,CAEH,CALD,CAOAC,UAAKC,IAAL,CAAU,CAAC,CACPC,UAAU,CAAE,6BADL,CAEPC,IAAI,CAAE,EAFC,CAGPC,IAAI,CAAE,cAACC,CAAD,CAAU,CACZC,UAAUC,MAAV,CAAiB,mBAAjB,CAAsCF,CAAtC,EAA4CG,IAA5C,CAAiD,SAACC,CAAD,CAAY,CACzDC,QAAQ,CAACC,aAAT,CAAuB,oBAAvB,EAA6CC,SAA7C,CAAyDH,CAAzD,CACAI,CAAI,GACJxB,CAAyB,CAACE,QAA1B,IACAC,CAAC,CAACC,IAAF,CAAOG,WAAP,CAAmB,mBAAnB,EACA,MAAO,KACV,CAND,EAMGkB,KANH,CAMSnB,CANT,CAOH,CAXM,CAYPoB,IAAI,CAAEpB,CAZC,CAAD,CAAV,CAcH,CAKM,GAAMkB,CAAAA,CAAI,CAAG,UAAM,CACtBxB,CAAyB,CAAGqB,QAAQ,CAACM,cAAT,CAAwB,mBAAxB,CAA5B,CACA3B,CAAyB,CAAC4B,gBAA1B,CAA2C,OAA3C,CAAoD,UAAM,CACtD3B,CAAa,EAChB,CAFD,CAGH,CALM,C","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for scheduled tasks page. At the moment this just lets you refresh the current\n * running tasks.\n *\n * @module tool_task/scheduledtasks\n * @package tool_task\n * @copyright 2019 The Open University\n * @license http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since 3.9\n */\n\nimport Ajax from 'core/ajax';\nimport Templates from 'core/templates';\nimport Notification from 'core/notification';\n\n/**\n * Button used to refresh running tasks.\n */\nlet refreshRunningTasksButton;\n\n/**\n * Handles a button click.\n */\nfunction buttonHandler() {\n    refreshRunningTasksButton.disabled = true;\n    M.util.js_pending('tool_task_refresh');\n\n    const showError = () => {\n        refreshRunningTasksButton.disabled = false;\n        M.util.js_complete('tool_task_refresh');\n        Notification.alert(M.util.get_string('error', 'moodle'),\n            M.util.get_string('error_loading', 'tool_task'), M.util.get_string('ok', 'moodle'));\n    };\n\n    Ajax.call([{\n        methodname: 'tool_task_get_running_tasks',\n        args: {},\n        done: (data) => {\n            Templates.render('tool_task/running', data).then((result) => {\n                document.querySelector('.tool_task_running').outerHTML = result;\n                init();\n                refreshRunningTasksButton.disabled = false;\n                M.util.js_complete('tool_task_refresh');\n                return null;\n            }).catch(showError);\n        },\n        fail: showError\n    }]);\n}\n\n/**\n * Initialises the button listener.\n */\nexport const init = () => {\n    refreshRunningTasksButton = document.getElementById('tool_task_refresh');\n    refreshRunningTasksButton.addEventListener('click', () => {\n        buttonHandler();\n    });\n};\n"],"file":"scheduledtasks.min.js"}