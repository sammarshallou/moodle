YUI.add("moodle-core_availability-form",function(e,t){M.core_availability=M.core_availability||{},M.core_availability.form={plugins:{},field:null,mainDiv:null,rootList:null,idCounter:0,init:function(){this.field=e.one("#id_availability"),this.field.setAttribute("aria-hidden","true"),this.mainDiv=e.Node.create('<div class="availability_field"></div>'),this.field.insert(this.mainDiv,"after");var t=this.field.get("value");if(t==="")this.rootList=new M.core_availability.List(null,!0);else{var n=e.JSON.parse(t);this.rootList=new M.core_availability.List(n,!0)}this.mainDiv.appendChild(this.rootList.node)},addPlugin:function(e){var t=e.replace(/^availability_/,"");this.plugins[t]=M[e].form}},M.core_availability.List=function(t,n){n!==undefined&&(this.root=n),this.node=e.Node.create('<div class="availability_list"><div class="availability_header">'+M.str.availability.listheader_sign_before+' <select class="availability_neg"><option value="">'+M.str.availability.listheader_sign_pos+"</option>"+'<option value="!">'+M.str.availability.listheader_sign_neg+"</option></select> "+'<span class="availability_single">'+M.str.availability.listheader_single+"</span>"+'<span class="availability_multi">'+M.str.availability.listheader_multi_before+' <select class="availability_op"><option value="&">'+M.str.availability.listheader_multi_and+"</option>"+'<option value="|">'+M.str.availability.listheader_multi_or+"</option></select> "+M.str.availability.listheader_multi_after+"</span></div>"+'<div class="availability_children"></div>'+'<div class="availability_none">'+M.str.moodle.none+"</div>"+'<div class="availability_button"></div></div>'),!n;var r=e.Node.create('<button type="button" class="btn btn-default">'+M.str.availability.addrestriction+"</button>");r.on("click",function(){this.clickAdd()},this),this.node.one("div.availability_button").appendChild(r);if(t){switch(t.op){case"&":case"|":this.node.one(".availability_neg").set("value","");break;case"!&":case"!|":this.node.one(".availability_neg").set("value","!")}switch(t.op){case"&":case"!&":this.node.one(".availability_op").set("value","&");break;case"|":case"!|":this.node.one(".availability_op").set("value","|")}for(var i=0;i<t.c.length;i++){var s=t.c[i],o;s.type!==undefined?o=new M.core_availability.Item(s):o=children.push(new M.core_availability.List(s)),children.push(o),this.node.one(".availability_list > availability_children").appendChild(o.node)}this.root}this.updateHtml()},M.core_availability.List.prototype.updateHtml=function(){this.children.length>0?(this.node.one("> .availability_children").removeAttribute("aria-hidden"),this.node.one("> .availability_none").setAttribute("aria-hidden","true"),this.node.one("> .availability_header").removeAttribute("aria-hidden"),this.children.length>1?(this.node.one(".availability_single").setAttribute("aria-hidden","true"),this.node.one(".availability_multi").removeAttribute("aria-hidden")):(this.node.one(".availability_single").removeAttribute("aria-hidden"),this.node.one(".availability_multi").setAttribute("aria-hidden","true"))):(this.node.one("> .availability_children").setAttribute("aria-hidden","true"),this.node.one("> .availability_none").removeAttribute("aria-hidden"),this.node.one("> .availability_header").setAttribute("aria-hidden","true"))},M.core_availability.List.prototype.clickAdd=function(){var t=e.Node.create("<p>I am still silly</p>"),n={headerContent:M.str.availability.addrestriction,bodyContent:t,draggable:!0,modal:!0},r=new M.core.dialogue(n);r.show()},M.core_availability.List.prototype.root=!1,M.core_availability.List.prototype.children=[],M.core_availability.List.prototype.node=null,M.core_availability.Item=function(t){this.plugins[t.type]===undefined?(this.plugin=null,this.node=e.node.create('<div class="availability_warning">'+M.str.availability.addrestriction+"</div>")):(this.plugin=this.plugins[t.type],this.node=this.plugin.getNode(t))},M.core_availability.Item.prototype.plugin=null,M.core_availability.Item.prototype.node=null},"@VERSION@",{requires:["base","node","panel","moodle-core-notification-dialogue","moodle-core-actionmenu","json"]});
